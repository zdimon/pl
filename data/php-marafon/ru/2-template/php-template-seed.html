<h1>Ставим шаблон. Наполняем базу данных.</h1>

<p><a href="https://github.com/zdimon/laravel-blog">ссылка на репозиторий</a></p>

<p><a href="https://themes.3rdwavemedia.com/">ссылка на бесплатные шаблоны</a></p>

<p>Переименуем resources/views/welcome.blade.php </p>

<p>в</p>

<p>resources/views/layout.blade.php </p>

<p>Изменим имя шаблона в routes/web.php.</p>

<pre><code>Route::get('/', function () {
    return view('layout');
});
</code></pre>

<p>Вставляем шаблон в resources/views/layout.blade.php</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;!--[if IE 8]&gt; &lt;html lang="en" class="ie8"&gt; &lt;![endif]--&gt;  
&lt;!--[if IE 9]&gt; &lt;html lang="en" class="ie9"&gt; &lt;![endif]--&gt;  
&lt;!--[if !IE]&gt;&lt;!--&gt; &lt;html lang="en"&gt; &lt;!--&lt;![endif]--&gt;  
&lt;head&gt;
    &lt;title&gt;Responsive Portfolio Template for Developers&lt;/title&gt;
    &lt;!-- Meta --&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta name="description" content="Responsive HTML5 Website Landing Page for Developers"&gt;
    &lt;meta name="author" content="Xiaoying Riley at 3rd Wave Media"&gt;    
    &lt;link rel="shortcut icon" href="favicon.ico"&gt;  
    &lt;link href='http://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'&gt;
    &lt;link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'&gt; 
    &lt;!-- Global CSS --&gt;
    &lt;link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css"&gt;   
    &lt;!-- Plugins CSS --&gt;
    &lt;link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.css"&gt;

    &lt;!-- github calendar css --&gt;
    &lt;link rel="stylesheet" href="assets/plugins/github-calendar/dist/github-calendar.css"
/&gt;
    &lt;!-- github acitivity css --&gt;
    &lt;link rel="stylesheet" href="assets/plugins/github-activity/src/github-activity.css"&gt;
    &lt;link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/octicons/2.0.2/octicons.min.css"&gt;

    &lt;!-- Theme CSS --&gt;  
    &lt;link id="theme-style" rel="stylesheet" href="assets/css/styles.css"&gt;
    &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;
    &lt;!--[if lt IE 9]&gt;
      &lt;script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"&gt;&lt;/script&gt;
      &lt;script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"&gt;&lt;/script&gt;
    &lt;![endif]--&gt;

&lt;/head&gt; 

&lt;body&gt;
    &lt;!-- ******HEADER****** --&gt; 
    &lt;header class="header"&gt;
        &lt;div class="container"&gt;                       
            &lt;img class="profile-image img-responsive pull-left" src="assets/images/profile.png" alt="James Lee" /&gt;
            &lt;div class="profile-content pull-left"&gt;
                &lt;h1 class="name"&gt;James Lee&lt;/h1&gt;
                &lt;h2 class="desc"&gt;Web App Developer&lt;/h2&gt;   
                &lt;ul class="social list-inline"&gt;
                    &lt;li&gt;&lt;a href="#"&gt;&lt;i class="fa fa-twitter"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;                   
                    &lt;li&gt;&lt;a href="#"&gt;&lt;i class="fa fa-google-plus"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="#"&gt;&lt;i class="fa fa-linkedin"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="#"&gt;&lt;i class="fa fa-github-alt"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;                  
                    &lt;li class="last-item"&gt;&lt;a href="#"&gt;&lt;i class="fa fa-hacker-news"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;                 
                &lt;/ul&gt; 
            &lt;/div&gt;&lt;!--//profile--&gt;
            &lt;a class="btn btn-cta-primary pull-right" href="http://themes.3rdwavemedia.com/" target="_blank"&gt;&lt;i class="fa fa-paper-plane"&gt;&lt;/i&gt; Contact Me&lt;/a&gt;              
        &lt;/div&gt;&lt;!--//container--&gt;
    &lt;/header&gt;&lt;!--//header--&gt;

    &lt;div class="container sections-wrapper"&gt;
        &lt;div class="row"&gt;
            &lt;div class="primary col-md-8 col-sm-12 col-xs-12"&gt;
                &lt;section class="about section"&gt;
                    &lt;div class="section-inner"&gt;
                        &lt;h2 class="heading"&gt;About Me&lt;/h2&gt;
                        &lt;div class="content"&gt;
                            &lt;p&gt;Write a brief intro about yourself&lt;/p&gt;    
                        &lt;/div&gt;&lt;!--//content--&gt;
                    &lt;/div&gt;&lt;!--//section-inner--&gt;                 
                &lt;/section&gt;&lt;!--//section--&gt;

               &lt;section class="latest section"&gt;
                    &lt;div class="section-inner"&gt;
                        &lt;h2 class="heading"&gt;Latest Projects&lt;/h2&gt;
                        &lt;div class="content"&gt;    


                            &lt;hr class="divider" /&gt;
                            &lt;div class="item row"&gt;
                                &lt;a class="col-md-4 col-sm-4 col-xs-12" href="http://themes.3rdwavemedia.com/website-templates/responsive-bootstrap-theme-mobile-apps-atom/" target="_blank"&gt;
                                &lt;img class="img-responsive project-image" src="assets/images/projects/project-5.png" alt="project name" /&gt;
                                &lt;/a&gt;
                                &lt;div class="desc col-md-8 col-sm-8 col-xs-12"&gt;
                                    &lt;h3 class="title"&gt;&lt;a href="http://themes.3rdwavemedia.com/website-templates/responsive-bootstrap-theme-mobile-apps-atom/" target="_blank"&gt;Atom - Designed for Mobile Apps&lt;/a&gt;&lt;/h3&gt;
                                    &lt;p&gt;You can put one of your secondary projects here. Suspendisse in tellus dolor. Vivamus a tortor eu turpis pharetra consequat quis non metus. Aliquam aliquam, orci eu suscipit pellentesque, mauris dui tincidunt enim, eget iaculis ante dolor non turpis.&lt;/p&gt;
                                    &lt;p&gt;&lt;a class="more-link" href="http://themes.3rdwavemedia.com/website-templates/responsive-bootstrap-theme-mobile-apps-atom/" target="_blank"&gt;&lt;i class="fa fa-external-link"&gt;&lt;/i&gt; Find out more&lt;/a&gt;&lt;/p&gt;
                                &lt;/div&gt;&lt;!--//desc--&gt;                          
                            &lt;/div&gt;&lt;!--//item--&gt;




                        &lt;/div&gt;&lt;!--//content--&gt;  
                    &lt;/div&gt;&lt;!--//section-inner--&gt;                 
                &lt;/section&gt;&lt;!--//section--&gt;



            &lt;/div&gt;&lt;!--//primary--&gt;
            &lt;div class="secondary col-md-4 col-sm-12 col-xs-12"&gt;

                &lt;aside class="list music aside section"&gt;
                    &lt;div class="section-inner"&gt;
                        &lt;h2 class="heading"&gt;Categories&lt;/h2&gt;
                        &lt;div class="content"&gt;
                            &lt;ul class="list-unstyled"&gt;
                                &lt;li&gt;&lt;i class="fa fa-headphones"&gt;&lt;/i&gt; &lt;a href="#"&gt;Python&lt;/a&gt;&lt;/li&gt;
                                &lt;li&gt;&lt;i class="fa fa-headphones"&gt;&lt;/i&gt; &lt;a href="#"&gt;Javascript&lt;/a&gt;&lt;/li&gt;
                                &lt;li&gt;&lt;i class="fa fa-headphones"&gt;&lt;/i&gt; &lt;a href="#"&gt;PHP&lt;/a&gt;&lt;/li&gt;
                            &lt;/ul&gt;
                        &lt;/div&gt;&lt;!--//content--&gt;
                    &lt;/div&gt;&lt;!--//section-inner--&gt;
                &lt;/aside&gt;&lt;!--//section--&gt;

                &lt;aside class="blog aside section"&gt;
                    &lt;div class="section-inner"&gt;
                        &lt;h2 class="heading"&gt;Latest Blog Posts&lt;/h2&gt;
                        &lt;p&gt;You can use Sascha Depold's &lt;a href="https://github.com/sdepold/jquery-rss" target="_blank"&gt;jQuery RSS plugin&lt;/a&gt; to pull in your blog post feeds.&lt;/p&gt;
                        &lt;div id="rss-feeds" class="content"&gt;

                        &lt;/div&gt;&lt;!--//content--&gt;
                    &lt;/div&gt;&lt;!--//section-inner--&gt;
                &lt;/aside&gt;&lt;!--//section--&gt;



            &lt;/div&gt;&lt;!--//secondary--&gt;    
        &lt;/div&gt;&lt;!--//row--&gt;
    &lt;/div&gt;&lt;!--//masonry--&gt;

    &lt;!-- ******FOOTER****** --&gt; 
    &lt;footer class="footer"&gt;
        &lt;div class="container text-center"&gt;
                &lt;!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can check out other license options via our website: themes.3rdwavemedia.com */--&gt;
                &lt;small class="copyright"&gt;Designed with &lt;i class="fa fa-heart"&gt;&lt;/i&gt; by &lt;a href="http://themes.3rdwavemedia.com" target="_blank"&gt;Xiaoying Riley&lt;/a&gt; for developers&lt;/small&gt;
        &lt;/div&gt;&lt;!--//container--&gt;
    &lt;/footer&gt;&lt;!--//footer--&gt;

    &lt;!-- Javascript --&gt;          
    &lt;script type="text/javascript" src="assets/plugins/jquery-1.11.3.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"&gt;&lt;/script&gt;    
    &lt;script type="text/javascript" src="assets/plugins/jquery-rss/dist/jquery.rss.min.js"&gt;&lt;/script&gt; 
    &lt;!-- github calendar plugin --&gt;
    &lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/3.0.2/es6-promise.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fetch/0.10.1/fetch.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="assets/plugins/github-calendar/dist/github-calendar.min.js"&gt;&lt;/script&gt;
    &lt;!-- github activity plugin --&gt;
    &lt;script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="assets/plugins/github-activity/src/github-activity.js"&gt;&lt;/script&gt;
    &lt;!-- custom js --&gt;
    &lt;script type="text/javascript" src="assets/js/main.js"&gt;&lt;/script&gt;            
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Копируем из шаблона папку assets в public.</p>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/1.png" alt="admin" /></p>

<p>Создаем миграцию для страниц.</p>

<pre><code>php artisan make:migration create_page_table
</code></pre>

<p>Создаем мишрацию для категорий</p>

<pre><code>php artisan make:migration create_category_table
</code></pre>

<p>Создаем миграцию для постов.</p>

<pre><code>php artisan make:migration create_post_table
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/2.png" alt="admin" /></p>

<p>Заполняем структуру таблицы для страниц database/migrations/<datetime><em>create</em>page_table.php.</p>

<pre><code>public function up()
{
    Schema::create('page', function (Blueprint $table) {
        $table-&gt;id();
        $table-&gt;timestamps();
        $table-&gt;string('title');
        $table-&gt;string('image');
        $table-&gt;text('content');
    });
}
</code></pre>

<p>Для категорий.</p>

<pre><code>public function up()
{
    Schema::create('category', function (Blueprint $table) {
        $table-&gt;id();
        $table-&gt;timestamps();
        $table-&gt;string('name');
    });
}
</code></pre>

<p>Для постов.</p>

<pre><code>public function up()
{
    Schema::create('post', function (Blueprint $table) {
        $table-&gt;id();
        $table-&gt;timestamps();
        $table-&gt;string('title');
        $table-&gt;string('image');
        $table-&gt;text('content');
    });
}
</code></pre>

<p>Применяем миграцию.</p>

<pre><code>php artisan migrate
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/3.png" alt="admin" /></p>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/4.png" alt="admin" /></p>

<p>Создаем файл с фикстурами (тестовыми данными) fixture.json со страницами.</p>

<pre><code>{
    "pages": [
        {
            "title": "Test title 1",
            "content": "Test content 1",
            "image": "image1.jpg"
        }, 
        {
            "title": "Test title 2",
            "content": "Test content 2",
            "image": "image2.jpg"
        }        
    ]
}
</code></pre>

<p>Создаем модель под страницы, категори и посты.</p>

<pre><code>php artisan make:model Page
php artisan make:model Category
php artisan make:model Post
</code></pre>

<p>Прописывем таблицы в каждом классе модели в каталоге app.</p>

<pre><code>&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Category extends Model
{
    protected $table = 'category';
}


&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Page extends Model
{
    protected $table = 'page';
}

&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Post extends Model
{
    protected $table = 'post';
}
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/7.png" alt="admin" /></p>

<h2>Загрузка страниц.</h2>

<p>Создаем сеятеля для станиц.</p>

<pre><code>php artisan make:seeder PageSeeder
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/5.png" alt="admin" /></p>

<p>Заполняем таблицу данными из fixtures.json в database/seeds/PageSeeder.php</p>

<pre><code>&lt;?php

use Illuminate\Database\Seeder;
use App\Page;
class PageSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        $path = base_path().'/fixtures.json';
        $content = file_get_contents($path);
        $data = json_decode($content);
        Page::truncate();
        foreach($data-&gt;pages as $item){
            echo "Inserting ".$item-&gt;title."\n";
            DB::table('page')-&gt;insert([
                'title' =&gt; $item-&gt;title,
                'content' =&gt; $item-&gt;content,
                'image' =&gt; $item-&gt;image
            ]);
        }

    }
}
</code></pre>

<p>Альтернативный способ создания записи.</p>

<pre><code>$page = new Page();
$page-&gt;title = $item-&gt;title;
$page-&gt;content = $item-&gt;content;
$page-&gt;image = $item-&gt;image;
$page-&gt;save();
</code></pre>

<p>Обновляем автозагрузчик.</p>

<pre><code>composer dump-autoload
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/6.png" alt="admin" /></p>

<p>Запуск сеятеля.</p>

<pre><code>php artisan db:seed --class=PageSeeder
</code></pre>

<h1>Загрузка категорий.</h1>

<p>Добавляем категории в фикстуры.</p>

<pre><code>{
    "pages": [
        ...        
    ],
    "categories": [
        {
            "name": "PHP"
        }, 
        {
            "name": "Python"
        }, 
        {
            "name": "Javascript"
        }    
    ]
}
</code></pre>

<p>Класс сеятеля.</p>

<pre><code>php artisan make:seeder CategorySeeder
</code></pre>

<p>Сеим таблицу категорий.</p>

<pre><code>php artisan db:seed --class=CategorySeeder
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/8.png" alt="admin" /></p>

<h1>Загрузка постов.</h1>

<p>Добавляем посты в фикстуры.</p>

<pre><code>{
    "pages": [
        ...     
    ],
    "categories": [
       ...    
    ],

    "posts": [
        {
            "title": "Title about PHP",
            "image": "image_post1.jpeg",
            "content": "Content about PHP",
            "category": "PHP"
        }, 
        {
            "title": "Title about Python",
            "image": "image_post1.jpeg",
            "content": "Content about Python",
            "category": "PHP"
        }, 
        {
            "title": "Title about Javascript",
            "image": "image_post1.jpeg",
            "content": "Content about Javascript",
            "category": "PHP"
        }    
    ]
}
</code></pre>

<p>Создаем класс сеятеля.</p>

<pre><code>php artisan make:seeder PostSeeder

php artisan migrate:reset
</code></pre>

<p>Добавим внешний ключ в схему с постами.</p>

<pre><code>    Schema::create('post', function (Blueprint $table) {
        ...
        $table-&gt;unsignedBigInteger('category_id');
        $table-&gt;foreign('category_id')-&gt;references('id')-&gt;on('category')-&gt;onDelete('cascade'); 
    });
</code></pre>

<p>Создаем логику засеивания.</p>

<pre><code>&lt;?php

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use App\Category;
use App\Post;
class PostSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        $path = base_path().'/fixtures.json';
        $content = file_get_contents($path);
        $data = json_decode($content);
        Post::truncate();
        foreach($data-&gt;posts as $item){
            echo "Inserting ".$item-&gt;title."\n";
            $cat = DB::table('category')-&gt;where('name', $item-&gt;category)-&gt;first();

            DB::table('post')-&gt;insert([
                'title' =&gt; $item-&gt;title,
                'content' =&gt; $item-&gt;content,
                'image' =&gt; $item-&gt;image,
                'category_id' =&gt; $cat-&gt;id
            ]);
        }
    }
}
</code></pre>

<p>Засеиваем.</p>

<pre><code>php artisan db:seed --class=PostSeeder
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/10.png" alt="admin" /></p>

<p>Меняем </p>

<pre><code>Category::truncate();
</code></pre>

<p>на</p>

<pre><code>DB::table('category')-&gt;delete();
</code></pre>

<p><img src="https://webmonstr.com/media/course/php-marafon/ru/2-template/images/9.png" alt="admin" /></p>
